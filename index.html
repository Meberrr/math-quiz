<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ•¸å­¸å‰å¾Œæ¸¬å•å·</title>
  <style>
    body { font-family: "Microsoft JhengHei"; margin: 40px; background-color: #f9f9f9; }
    h2 { color: #2a4d8f; }
    input, select { padding: 6px; margin: 6px; }
    button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:disabled { background-color: #aaa; cursor: not-allowed; }
    button:hover:not(:disabled) { background-color: #45a049; }
  </style>

  <!-- âœ… Firebase å…¼å®¹ç‰ˆ -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h2>æ•¸å­¸å‰å¾Œæ¸¬å•å·</h2>
<p><strong>è‡ªè¨‚ä»£è™Ÿï¼ˆå…±å››ç¢¼ï¼‰</strong>ï¼šç”Ÿæ—¥æœˆä»½ + åº§è™Ÿï¼ˆä¾‹å¦‚ï¼š7æœˆ3è™Ÿ â†’ 0703ï¼‰</p>

<select id="classSelect">
  <option value="Aç­">Aç­</option>
  <option value="Bç­">Bç­</option>
  <option value="Cç­">Cç­</option>
</select>

<input type="text" id="studentId" placeholder="è«‹è¼¸å…¥è‡ªè¨‚ä»£è™Ÿï¼ˆå››ç¢¼ï¼‰" />

<form id="quizForm">
  <ol>
    <li>11 + 27 = <input type="number" id="Q1"></li>
    <li>2 Ã— 12 Ã— 19 = <input type="number" id="Q2"></li>
    <li>24 Ã— 3 Ã— 11 = <input type="number" id="Q3"></li>
    <li>32 Ã· 4 + 4 = <input type="number" id="Q4"></li>
    <li>15 Ã· 3 Ã— 23 = <input type="number" id="Q5"></li>
    <li>9 Ã— 6 Ã· 27 = <input type="number" id="Q6"></li>
    <li>15 Ã— (30 - 13) = <input type="number" id="Q7"></li>
    <li>21 Ã— (27 Ã· 3) = <input type="number" id="Q8"></li>
    <li>(30 - 14) Ã· 4 = <input type="number" id="Q9"></li>
  </ol>
  <button type="button" id="submitBtn" onclick="submitQuiz()">é€å‡ºç­”æ¡ˆ</button>
</form>

<p id="result"></p>

<script>
  // âœ… ä½ çš„ Firebase è¨­å®šï¼ˆè«‹æ›æˆè‡ªå·±çš„ï¼‰
const firebaseConfig = {
  apiKey: "AIzaSyD9LY_TmhTJjEbtWkYLX9OsqTCZKYafjPg",
  authDomain: "math-quiz-a0fcf.firebaseapp.com",
  projectId: "math-quiz-a0fcf",
  storageBucket: "math-quiz-a0fcf.firebasestorage.app",
  messagingSenderId: "137657638927",
  appId: "1:137657638927:web:b6c450f8cec9978620c37a"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function submitQuiz() {
    const btn = document.getElementById("submitBtn");
    const startTime = window.startTime || Date.now();

    // é˜²æ­¢é‡è¤‡é»æ“Š
    btn.disabled = true;

    const data = {
      class: document.getElementById("classSelect").value,
      studentId: document.getElementById("studentId").value.trim(),
      Q1: document.getElementById("Q1").value,
      Q2: document.getElementById("Q2").value,
      Q3: document.getElementById("Q3").value,
      Q4: document.getElementById("Q4").value,
      Q5: document.getElementById("Q5").value,
      Q6: document.getElementById("Q6").value,
      Q7: document.getElementById("Q7").value,
      Q8: document.getElementById("Q8").value,
      Q9: document.getElementById("Q9").value,
    };

    // âœ… è¨ˆç®—åˆ†æ•¸èˆ‡æ™‚é–“
    const result = calculateScore();
    data.correctCount = result.correctCount;
    data.score = result.score; // 100 åˆ†åˆ¶
    data.timeSpent = ((Date.now() - startTime) / 1000).toFixed(2);
    data.timestamp = new Date();

    try {
      await db.collection("quizResults").add(data);

      alert("ä½œç­”å®Œæˆï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡ ğŸ™Œ");

      // é–å®šæ‰€æœ‰è¼¸å…¥æ¬„ä½èˆ‡æŒ‰éˆ•
      const inputs = document.querySelectorAll("input, select, button");
      inputs.forEach(el => el.disabled = true);

      // é¡¯ç¤ºçµæœ
      document.getElementById("result").innerHTML =
        `<strong>âœ… å·²é€å‡ºï¼</strong><br>
         ç­”å°ï¼š${result.correctCount}/9 é¡Œ<br>
         åˆ†æ•¸ï¼š${result.score} åˆ†<br>
         ä½œç­”æ™‚é–“ï¼š${data.timeSpent} ç§’`;

    } catch (err) {
      alert("âŒ éŒ¯èª¤ï¼š" + err.message);
      btn.disabled = false; // å¦‚æœå¤±æ•—å†å•Ÿç”¨æŒ‰éˆ•
    }
  }

  // âœ… å°‡ 9 é¡Œè½‰ç‚º 100 åˆ†åˆ¶
  function calculateScore() {
    const correct = [38, 456, 792, 12, 115, 2, 255, 189, 4];
    let correctCount = 0;
    for (let i = 1; i <= 9; i++) {
      if (parseInt(document.getElementById(`Q${i}`).value) === correct[i - 1]) {
        correctCount++;
      }
    }
    // æ¯é¡Œç´„ 11.11 åˆ†
    const score = Math.round((correctCount / 9) * 100);
    return { correctCount, score };
  }

  window.onload = () => window.startTime = Date.now();
</script>

</body>
</html>
