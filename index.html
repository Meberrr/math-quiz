<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ•¸å­¸å‰å¾Œæ¸¬å•å·</title>
  <style>
    body { font-family: "Microsoft JhengHei"; margin: 40px; background-color: #f9f9f9; }
    h2 { color: #2a4d8f; }
    input, select { padding: 6px; margin: 6px; }
    button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:disabled { background-color: #aaa; cursor: not-allowed; }
    button:hover:not(:disabled) { background-color: #45a049; }
    .hidden { display: none; }

    /* âœ… é¡Œè™Ÿèˆ‡é¡Œç›®ä¹‹é–“ç•™å¤§ç©ºæ ¼ */
    ol { list-style-position: inside; padding-left: 0; }
    ol li {
      margin-bottom: 14px;
      text-indent: -1.5em; /* èª¿æ•´é¡Œè™Ÿç¸®æ’ */
    }
    ol li::marker {
      content: counter(list-item) ".â€ƒâ€ƒâ€ƒ"; /* â† é€™è£¡æ˜¯ä¸‰å€‹å…¨å½¢ç©ºæ ¼ï¼ˆå¯ä»¥å†åŠ å¤šï¼‰ */
      font-weight: bold;
    }
  </style>

  <!-- âœ… Firebase å…¼å®¹ç‰ˆ -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h2>æ•¸å­¸å‰å¾Œæ¸¬å•å·</h2>

<!-- âœ… æ–°å¢ã€Œé¸æ“‡æ¸¬é©—éšæ®µã€ -->
<div id="stageSelectArea">
  <p><strong>è«‹é¸æ“‡ç›®å‰é€²è¡Œçš„æ¸¬é©—éšæ®µï¼š</strong></p>
  <button onclick="selectStage('å‰æ¸¬')">å‰æ¸¬</button>
  <button onclick="selectStage('å¾Œæ¸¬')">å¾Œæ¸¬</button>
</div>

<!-- âœ… ä¸»å•å·å€ -->
<div id="quizArea" class="hidden">
  <p><strong>æ¸¬é©—éšæ®µï¼š</strong><span id="testTypeLabel"></span></p>
  <p><strong>è‡ªè¨‚ä»£è™Ÿï¼ˆå…±å››ç¢¼ï¼‰</strong>ï¼šç”Ÿæ—¥æœˆä»½ + åº§è™Ÿï¼ˆä¾‹å¦‚ï¼š7æœˆ3è™Ÿ â†’ 0703ï¼‰</p>

  <select id="classSelect">
    <option value="Aç­">Aç­</option>
    <option value="Bç­">Bç­</option>
    <option value="Cç­">Cç­</option>
  </select>

  <input type="text" id="studentId" placeholder="è«‹è¼¸å…¥è‡ªè¨‚ä»£è™Ÿï¼ˆå››ç¢¼ï¼‰" />

  <form id="quizForm">
    <ol>
      <li>11 + 27 = <input type="number" id="Q1"></li>
      <li>2 Ã— 12 Ã— 19 = <input type="number" id="Q2"></li>
      <li>24 Ã— 3 Ã— 11 = <input type="number" id="Q3"></li>
      <li>32 Ã· 4 + 4 = <input type="number" id="Q4"></li>
      <li>15 Ã· 3 Ã— 23 = <input type="number" id="Q5"></li>
      <li>9 Ã— 6 Ã· 27 = <input type="number" id="Q6"></li>
      <li>15 Ã— (30 - 13) = <input type="number" id="Q7"></li>
      <li>21 Ã— (27 Ã· 3) = <input type="number" id="Q8"></li>
      <li>(30 - 14) Ã· 4 = <input type="number" id="Q9"></li>
    </ol>
    <button type="button" id="submitBtn" onclick="submitQuiz()">é€å‡ºç­”æ¡ˆ</button>
  </form>

  <p id="result"></p>
</div>

<script>
  // âœ… Firebase è¨­å®šï¼ˆè«‹æ›æˆè‡ªå·±çš„ï¼‰
const firebaseConfig = {
  apiKey: "AIzaSyD9LY_TmhTJjEbtWkYLX9OsqTCZKYafjPg",
  authDomain: "math-quiz-a0fcf.firebaseapp.com",
  projectId: "math-quiz-a0fcf",
  storageBucket: "math-quiz-a0fcf.firebasestorage.app",
  messagingSenderId: "137657638927",
  appId: "1:137657638927:web:b6c450f8cec9978620c37a"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let selectedTestType = "";

  function selectStage(type) {
    selectedTestType = type;
    document.getElementById("testTypeLabel").textContent = type;
    document.getElementById("stageSelectArea").classList.add("hidden");
    document.getElementById("quizArea").classList.remove("hidden");
    window.startTime = Date.now();
  }

  async function submitQuiz() {
    const btn = document.getElementById("submitBtn");
    btn.disabled = true;

    const data = {
      testType: selectedTestType,
      class: document.getElementById("classSelect").value,
      studentId: document.getElementById("studentId").value.trim(),
      Q1: document.getElementById("Q1").value,
      Q2: document.getElementById("Q2").value,
      Q3: document.getElementById("Q3").value,
      Q4: document.getElementById("Q4").value,
      Q5: document.getElementById("Q5").value,
      Q6: document.getElementById("Q6").value,
      Q7: document.getElementById("Q7").value,
      Q8: document.getElementById("Q8").value,
      Q9: document.getElementById("Q9").value,
    };

    const result = calculateScore();
    data.correctCount = result.correctCount;
    data.score = result.score;
    data.timeSpent = ((Date.now() - window.startTime) / 1000).toFixed(2);
    data.timestamp = new Date();

    try {
      await db.collection("quizResults").add(data);

      alert(`ä½œç­”å®Œæˆï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼ˆ${selectedTestType}ï¼‰ğŸ™Œ`);

      // âœ… é–å®šæ‰€æœ‰è¼¸å…¥èˆ‡æŒ‰éˆ•
      document.querySelectorAll("input, select, button").forEach(el => el.disabled = true);

      document.getElementById("result").innerHTML =
        `<strong>âœ… ${selectedTestType}å·²é€å‡ºï¼</strong><br>
         ç­”å°ï¼š${result.correctCount}/9 é¡Œ<br>
         åˆ†æ•¸ï¼š${result.score} åˆ†<br>
         ä½œç­”æ™‚é–“ï¼š${data.timeSpent} ç§’`;

    } catch (err) {
      alert("âŒ éŒ¯èª¤ï¼š" + err.message);
      btn.disabled = false;
    }
  }

  function calculateScore() {
    const correct = [38, 456, 792, 12, 115, 2, 255, 189, 4];
    let correctCount = 0;
    for (let i = 1; i <= 9; i++) {
      if (parseInt(document.getElementById(`Q${i}`).value) === correct[i - 1]) {
        correctCount++;
      }
    }
    const score = Math.round((correctCount / 9) * 100);
    return { correctCount, score };
  }
</script>

</body>
</html>
