<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>數學前後測問卷</title>
  <style>
    body { font-family: "Microsoft JhengHei"; margin: 40px; background-color: #f9f9f9; }
    h2 { color: #2a4d8f; }
    input, select { padding: 6px; margin: 6px; }
    button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #45a049; }
  </style>

  <!-- ✅ 非 module 版本的 Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>

<body>

<h2>數學前後測問卷</h2>
<p><strong>自訂代號（共四碼）</strong>：生日月份 + 座號（例如：7月3號 → 0703）</p>

<select id="classSelect">
  <option value="A班">A班</option>
  <option value="B班">B班</option>
  <option value="C班">C班</option>
</select>

<input type="text" id="studentId" placeholder="請輸入自訂代號（四碼）" />

<form id="quizForm">
  <ol>
    <li>11 + 27 = <input type="number" id="Q1"></li>
    <li>2 × 12 × 19 = <input type="number" id="Q2"></li>
    <li>24 × 3 × 11 = <input type="number" id="Q3"></li>
    <li>32 ÷ 4 + 4 = <input type="number" id="Q4"></li>
    <li>15 ÷ 3 × 23 = <input type="number" id="Q5"></li>
    <li>9 × 6 ÷ 27 = <input type="number" id="Q6"></li>
    <li>15 × (30 - 13) = <input type="number" id="Q7"></li>
    <li>21 × (27 ÷ 3) = <input type="number" id="Q8"></li>
    <li>(30 - 14) ÷ 4 = <input type="number" id="Q9"></li>
  </ol>
  <button type="button" onclick="submitQuiz()">送出答案</button>
</form>

<p id="result"></p>

<script>
  // ✅ 你的 Firebase 設定（請換成你自己的）
const firebaseConfig = {
  apiKey: "AIzaSyD9LY_TmhTJjEbtWkYLX9OsqTCZKYafjPg",
  authDomain: "math-quiz-a0fcf.firebaseapp.com",
  projectId: "math-quiz-a0fcf",
  storageBucket: "math-quiz-a0fcf.firebasestorage.app",
  messagingSenderId: "137657638927",
  appId: "1:137657638927:web:b6c450f8cec9978620c37a"
};

  // ✅ 初始化 Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function submitQuiz() {
    const startTime = window.startTime || Date.now();

    const data = {
      class: document.getElementById("classSelect").value,
      studentId: document.getElementById("studentId").value,
      Q1: document.getElementById("Q1").value,
      Q2: document.getElementById("Q2").value,
      Q3: document.getElementById("Q3").value,
      Q4: document.getElementById("Q4").value,
      Q5: document.getElementById("Q5").value,
      Q6: document.getElementById("Q6").value,
      Q7: document.getElementById("Q7").value,
      Q8: document.getElementById("Q8").value,
      Q9: document.getElementById("Q9").value,
      score: calculateScore(),
      timeSpent: ((Date.now() - startTime) / 1000).toFixed(2),
      timestamp: new Date()
    };

    try {
      await db.collection("quizResults").add(data);
      document.getElementById("result").innerHTML =
        `<strong>✅ 已送出！</strong><br>答對：${data.score}/9 題<br>作答時間：${data.timeSpent} 秒`;
    } catch (err) {
      alert("❌ 錯誤：" + err.message);
    }
  }

  function calculateScore() {
    const correct = [38, 456, 792, 12, 115, 2, 255, 189, 4];
    let score = 0;
    for (let i = 1; i <= 9; i++) {
      if (parseInt(document.getElementById(`Q${i}`).value) === correct[i - 1]) score++;
    }
    return score;
  }

  window.onload = () => window.startTime = Date.now();
</script>

</body>
</html>
